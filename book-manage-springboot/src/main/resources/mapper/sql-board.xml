<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.kudong.book.mapper.BookMapper">
	<select id="selectBook" parameterType="int" resultType="kr.kudong.book.dto.BookDto">
		select book_id,title,author,publisher,
			date_format(published_date, '%Y.%m.%d') as published_date,
			genres,isbn,description,
			date_format(created_at, '%Y.%m.%d %H:%i:%s') as created_at,
			date_format(updated_at, '%Y.%m.%d %H:%i:%s') as updated_at
		from Books
		where book_id = #{id}
	</select>
	<select id="selectBookList" resultType="kr.kudong.book.dto.BookDto">
		select book_id,title,author,publisher,
			date_format(published_date, '%Y.%m.%d') as published_date,
			genres,isbn,description,
			date_format(created_at, '%Y.%m.%d %H:%i:%s') as created_at,
			date_format(updated_at, '%Y.%m.%d %H:%i:%s') as updated_at
		from Books
		order by book_id
	</select>
	<select id="selectBookListByKeyword" parameterType="String" resultType="kr.kudong.book.dto.BookDto">
		select book_id,title,author,publisher,
			date_format(published_date, '%Y.%m.%d') as published_date,
			genres,isbn,description,
			date_format(created_at, '%Y.%m.%d %H:%i:%s') as created_at,
			date_format(updated_at, '%Y.%m.%d %H:%i:%s') as updated_at
		from Books
		where title like CONCAT('%', #{keyword}, '%')
		order by book_id
	</select>	
	<delete id="removeBook" parameterType="int">
        delete from Books
        where book_id = #{bookId}  
    </delete>
    <update id="updateBook" parameterType="kr.kudong.book.dto.BookDto">
    	update Books set title = #{title}
		, author = #{author} 
		, publisher = #{publisher}
		, published_date = #{publishedDate}
		, genres = #{genres}
		, isbn = #{isbn}
		, description = #{description}
		, updated_at = now()
		where book_id = #{bookId}
    </update>
    <insert id="insertBook" parameterType="kr.kudong.book.dto.BookDto" useGeneratedKeys="true" keyProperty="bookId">
    	insert into Books(title,author,publisher,published_date,genres,isbn,description,created_at,updated_at)
		values (#{title},#{author},#{publisher},#{publishedDate},#{genres},#{isbn},#{description},now(),now())
    </insert>
</mapper>

